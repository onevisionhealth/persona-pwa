<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Persona Matcher</title>

<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
       max-width:680px;margin:2rem auto;background:#f7f7f9;padding:2rem;color:#222}
  input[type=text]{width:100%;padding:0.6rem;border:1px solid #bbb;border-radius:4px}
  button{margin-top:0.8rem;padding:0.6rem 1.2rem;border:0;border-radius:4px;
         background:#0066ff;color:#fff;font-weight:600;cursor:pointer}
  button:disabled{background:#8cb3ff;cursor:default}
  .persona{border:1px solid #ddd;border-radius:4px;background:#fff;padding:1rem;margin-top:1rem}
  .persona h3{margin:0;font-size:1.1rem}
  .small{font-size:0.85rem;color:#555}
  #toast{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);
         background:#222;color:#fff;padding:0.7rem 1rem;border-radius:4px;display:none}
</style>
</head>
<body>
<h1>Persona Matcher</h1>

<input id="urlInput" type="text" placeholder="Paste a web-page URL">
<button id="matchBtn">Match personas</button>

<div id="results"></div>
<div id="toast"></div>

<script>
const WEBHOOK_URL = "https://ovhpersonas.app.n8n.cloud/webhook-test/4416ff12-adef-445f-a1d7-d7a7731a8e3d";

/* ------------ helpers ------------ */
function toast(msg,ms=2500){
  const t=document.getElementById('toast');
  t.textContent=msg; t.style.display='block';
  setTimeout(()=>t.style.display='none',ms);
}
function setLoading(on){
  document.getElementById('matchBtn').disabled=on;
}

/* ------------ main flow ------------ */
async function fetchPersonas(){
  const url=document.getElementById('urlInput').value.trim();
  if(!url) return toast('Please enter a URL');

  setLoading(true);
  try{
    const res=await fetch(WEBHOOK_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({url})
    });
    if(!res.ok) throw new Error(await res.text());
    const personas=await res.json();      // expects array
    renderPersonas(personas);
  }catch(err){
    console.error(err);
    toast('Error: '+err.message);
  }finally{
    setLoading(false);
  }
}

function renderPersonas(list){
  const box=document.getElementById('results');
  box.innerHTML='';
  if(!Array.isArray(list)||!list.length){
    box.innerHTML='<p>No matching personas.</p>';
    return;
  }
  list.forEach(p=>{
    const el=document.createElement('div');
    el.className='persona';
    el.innerHTML=`
      <h3>${p.name || p.id}</h3>
      <p class="small">${p.role||''}</p>
      <p><strong>Goals:</strong> ${Array.isArray(p.goals)?p.goals.join('; '):''}</p>
      <p><strong>Pain points:</strong> ${Array.isArray(p.pain_points)?p.pain_points.join('; '):''}</p>`;
    box.appendChild(el);
  });
}

/* ------------ wire up UI ------------ */
document.getElementById('matchBtn').addEventListener('click',fetchPersonas);

/* optional: auto-run if ?url= param present */
window.addEventListener('DOMContentLoaded',()=>{
  const u=new URLSearchParams(location.search).get('url');
  if(u){document.getElementById('urlInput').value=u;fetchPersonas();}
});
</script>
</body>
</html>
